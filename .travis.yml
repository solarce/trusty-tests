sudo: required
language: bash
services:
  - docker
  - redis-server

before_script:
  - echo "host all all 172.17.0.0/24 trust" | sudo tee -a /etc/postgresql/9.1/main/pg_hba.conf
  - echo "listen_addresses='*'" | sudo tee -a /etc/postgresql/9.1/main/postgresql.conf
  - sudo service postgresql restart

script:
  - export PG_IP=172.17.0.1
  - export REDIS_IP=172.17.0.1
  - export POSTGRES_PASSWORD=postgres
  - docker run -it --name pg_test1 -e "PG_IP=$PG_IP" postgres:latest psql -h $PG_IP --username=postgres -c "show SERVER_VERSION" 
  - docker run -it --name redis_test1 -e "REDIS_IP=$REDIS_IP" redis:latest redis-cli -h $REDIS_IP info CPU
